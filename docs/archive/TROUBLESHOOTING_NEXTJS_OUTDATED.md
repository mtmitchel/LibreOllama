# üõ†Ô∏è LibreOllama Troubleshooting Guide\n\nThis guide covers common issues and their solutions for LibreOllama.\n\n## üö® Common Issues\n\n### 1. Authentication Errors (401 Infinite Loop)\n\n**Symptoms:**\n- Console flooded with 401 authentication errors\n- Infinite retry loop on chat sessions\n- App stuck loading or not responding\n\n**Root Cause:**\nTypically caused by:\n1. Database tables don't exist (migrations not run)\n2. Single-user mode not properly configured\n3. Frontend retry logic causing infinite loops\n\n**Solution:**\n```bash\n# Stop your dev server (Ctrl+C)\n\n# Option 1: Quick fix\nnode tools/test-and-fix-db.js\nnpm run dev\n\n# Option 2: Manual approach\nnpm run db:migrate\nnpm run db:init\nnpm run dev\n```\n\n**Verification:**\n- ‚úÖ No more 401 errors in console\n- ‚úÖ Chat sessions load properly\n- ‚úÖ Application works in single-user mode\n\n### 2. Chat Session Creation Errors\n\n**Symptoms:**\n- `createChatSession` console errors\n- Unable to create new chats\n- Messages not persisting\n\n**Root Cause:**\n1. Database tables not created\n2. Type system conflicts in repository layer\n3. Missing default user for single-user mode\n4. User ID mismatch between database and API routes\n\n**Solution:**\n```bash\n# Check database status first\nnode tools/quick-db-check.js\n\n# Get actual user ID from database\nnode tools/get-user-id.js\n\n# Fix database and user setup\nnode tools/test-and-fix-db.js\n```\n\n**Files That Were Fixed:**\n- `src/lib/database/repositories.ts` - Fixed type system\n- `src/app/api/chat/sessions/route.ts` - Added single-user mode support\n- `src/app/api/auth/session/route.ts` - Added single-user mode support\n- `src/hooks/use-chat.ts` - Fixed infinite retry loop & implemented sendMessage\n- `src/hooks/use-auth.ts` - Better error handling\n\n### 3. Message Deletion Not Working\n\n**Symptoms:**\n- Delete button doesn't appear\n- Messages don't delete when clicked\n- Database not updating\n\n**Solution:**\nThis has been fixed with:\n- New API endpoint: `POST/DELETE /api/chat/messages`\n- Delete button with trash icon (appears on hover)\n- Full database integration\n\n**Test deletion:**\n```bash\nnode tools/test-delete-message.js\n```\n\n### 4. Database Connection Issues\n\n**Symptoms:**\n- \"Database initialization failed\" errors\n- SQLite connection errors\n- Missing tables\n\n**Diagnosis:**\n```bash\n# Check database status\nnode tools/quick-db-check.js\n\n# Check database connection\nnode tools/test-db-connection.js\n\n# Diagnose database issues\nnode tools/diagnose-database.js\n```\n\n**Solutions:**\n```bash\n# Reset database completely\nnpm run db:reset\n\n# Or step by step\nrm -rf data/\nnpm run db:migrate\nnpm run db:init\n```\n\n### 5. Ollama Integration Issues\n\n**Symptoms:**\n- AI responses not working\n- \"Failed to connect to Ollama\" errors\n- Models not loading\n\n**Diagnosis:**\n```bash\n# Test Ollama connection\nnode tools/test-ollama.js\n\n# Check Ollama status\nollama list\nollama ps\n```\n\n**Solutions:**\n```bash\n# Start Ollama service\nollama serve\n\n# Pull recommended models\nollama pull mistral-nemo:latest\nollama pull qwen2.5:7b\n\n# Check OLLAMA_BASE_URL in .env.local\n# Should be: http://127.0.0.1:11434\n```\n\n### 6. Screen Layout Cut-off\n\n**Symptoms:**\n- Chat interface partially hidden\n- Content below screen boundary\n- Scroll issues\n\n**Solution:**\nFixed by updating layout height calculations in `src/app/chat/page.tsx`:\n- Changed from `h-[calc(100vh-8rem)]` to `h-[calc(100vh-12rem)]`\n- Accounts for header and padding properly\n\n### 7. User ID Mismatch\n\n**Symptoms:**\n- Authentication works but chat doesn't\n- \"User not found\" errors\n- API routes returning 401 despite auth\n\n**Diagnosis:**\n```bash\n# Check what user ID is in database\nnode tools/get-user-id.js\n```\n\n**Common Mismatch:**\n- Database has: `\"default-user\"`\n- API expecting: `\"00000000-0000-0000-0000-000000000000\"`\n\n**Solution:**\nAPI routes have been updated to use the correct `\"default-user\"` ID.\n\n## üîß Utility Scripts\n\nAll utility scripts are now in the `tools/` directory:\n\n```bash\n# Database utilities\nnode tools/quick-db-check.js      # Quick database status\nnode tools/check-db-status.js     # Detailed database info\nnode tools/test-db-connection.js  # Test database connectivity\nnode tools/diagnose-database.js   # Comprehensive database diagnosis\n\n# User management\nnode tools/get-user-id.js         # Get actual user ID from database\nnode tools/create-default-user.js # Create default user manually\n\n# Testing utilities\nnode tools/test-create-chat.js    # Test chat session creation API\nnode tools/test-delete-message.js # Test message deletion API\nnode tools/test-ollama.js         # Test Ollama integration\n\n# Fix utilities\nnode tools/test-and-fix-db.js     # Comprehensive database fix\nnode tools/fix-database.js        # Alternative database fix\n```\n\n## üîç Debugging Steps\n\n### Step 1: Check System Status\n```bash\n# Check database\nnode tools/quick-db-check.js\n\n# Check Ollama\nollama list\n\n# Check dev server\n# Should be running on http://localhost:9004\n```\n\n### Step 2: Check Configuration\n```bash\n# Verify .env.local settings\ncat .env.local\n\n# Key settings:\n# SINGLE_USER_MODE=true\n# USE_LOCAL_DATABASE=true\n# OLLAMA_BASE_URL=http://127.0.0.1:11434\n```\n\n### Step 3: Test Core Functions\n```bash\n# Test chat creation\nnode tools/test-create-chat.js\n\n# Test message deletion\nnode tools/test-delete-message.js\n\n# Test Ollama\nnode tools/test-ollama.js\n```\n\n### Step 4: Nuclear Option (Fresh Start)\n```bash\n# Complete reset\nrm -rf data/\nrm -rf .next/\nnpm run db:migrate\nnpm run db:init\nnpm run dev\n```\n\n## üìû Getting Help\n\nIf you're still experiencing issues:\n\n1. **Run diagnostics:** `node tools/diagnose-database.js`\n2. **Check logs:** Look at your terminal for specific error messages\n3. **Browser console:** Check for JavaScript errors\n4. **Network tab:** Look for failed API requests\n\n## ‚úÖ Expected Working State\n\nWhen everything is working correctly:\n- ‚úÖ No console errors\n- ‚úÖ Chat sessions load and display properly\n- ‚úÖ New chat creation works\n- ‚úÖ Messages can be sent and received\n- ‚úÖ Messages can be deleted (trash icon on hover)\n- ‚úÖ AI responses work with Ollama\n- ‚úÖ Database operations are fast and reliable\n- ‚úÖ No screen layout cut-off issues\n\n## üîÑ Maintenance\n\n### Regular Maintenance\n```bash\n# Check database health\nnode tools/quick-db-check.js\n\n# Backup database\ncp data/libreollama.db data/backup-$(date +%Y%m%d).db\n\n# Update Ollama models\nollama pull mistral-nemo:latest\n```\n\n### Performance Issues\n```bash\n# Clear Next.js cache\nrm -rf .next/\n\n# Restart development server\nnpm run dev\n```\n\nThis troubleshooting guide covers the most common issues encountered with LibreOllama. Most problems are related to database setup, authentication configuration, or Ollama integration.\n