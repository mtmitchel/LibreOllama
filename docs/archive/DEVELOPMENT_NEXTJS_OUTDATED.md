# 🚀 LibreOllama Development Guide\n\nComplete guide for developers working on LibreOllama.\n\n## 🏗️ Architecture Overview\n\nLibreOllama uses a **Node.js runtime-first architecture** for all authentication and database operations, specifically designed for local-first AI applications.\n\n### Technology Stack\n\n**Frontend:**\n- **Framework**: Next.js 15 with App Router\n- **UI**: React 18 + TypeScript\n- **Components**: ShadCN UI + Tailwind CSS\n- **Icons**: Lucide React\n\n**Backend:**\n- **Database**: SQLite with Drizzle ORM\n- **Authentication**: Local JWT with bcrypt\n- **AI Integration**: Ollama + local LLMs\n- **Runtime**: Node.js (not Edge Runtime)\n\n**Key Architectural Decisions:**\n- **No Edge Runtime**: All auth/database operations use Node.js runtime\n- **Local-First**: All data stays on user's machine\n- **Single-User Mode**: Designed for personal productivity\n- **Privacy-First**: No external dependencies required\n\n### Directory Structure\n\n```\nLibreOllama/\n├── src/\n│   ├── app/                    # Next.js App Router pages\n│   │   ├── api/               # API routes (Node.js runtime)\n│   │   ├── chat/              # Chat interface\n│   │   ├── dashboard/         # Main dashboard\n│   │   └── */                 # Other feature pages\n│   ├── components/            # Reusable UI components\n│   │   ├── ui/               # ShadCN base components\n│   │   ├── chat/             # Chat-specific components\n│   │   ├── layout/           # Layout components\n│   │   └── */                # Feature-specific components\n│   ├── hooks/                # Custom React hooks\n│   ├── lib/                  # Utilities and configurations\n│   │   ├── database/         # Database schema and operations\n│   │   ├── auth/             # Authentication logic\n│   │   └── */                # Other utilities\n│   └── ai/                   # AI integration and workflows\n├── data/                     # Local SQLite database\n├── tools/                    # Development and testing utilities\n├── scripts/                  # Database and build scripts\n├── drizzle/                  # Database migrations\n├── docs/                     # Documentation\n└── tests/                    # Test files\n```\n\n## 🛠️ Development Setup\n\n### Prerequisites\n\n1. **Node.js 18+** and npm/yarn/pnpm\n2. **Ollama** installed locally ([Download](https://ollama.ai))\n3. **Git** for version control\n4. **VS Code** (recommended) with extensions:\n   - TypeScript and JavaScript Language Features\n   - Tailwind CSS IntelliSense\n   - ES7+ React/Redux/React-Native snippets\n\n### Initial Setup\n\n```bash\n# Clone the repository\ngit clone <repository-url>\ncd LibreOllama\n\n# Install dependencies\nnpm install\n\n# Set up environment\ncp .env.local.example .env.local  # If example exists\n# Or verify .env.local has required settings\n\n# Set up database\nnpm run db:migrate\nnpm run db:init\n\n# Start development server\nnpm run dev\n```\n\n### Environment Configuration\n\nEnsure your `.env.local` includes:\n\n```bash\n# Local-First Configuration\nUSE_LOCAL_DATABASE=true\nSINGLE_USER_MODE=true\nSQLITE_DB_PATH=./data/libreollama.db\nJWT_SECRET=your-secure-jwt-secret-change-in-production\n\n# Ollama Configuration\nOLLAMA_BASE_URL=http://127.0.0.1:11434\n\n# Development\nNODE_ENV=development\nNEXT_TELEMETRY_DISABLED=1\n\n# Optional External Services\nBRAVE_SEARCH_API_KEY=your_key_optional\nGEMINI_API_KEY=your_key_optional\n```\n\n## 📝 Development Workflow\n\n### Daily Development\n\n```bash\n# Start development server\nnpm run dev\n\n# Open in browser: http://localhost:9004\n\n# Run type checking (in another terminal)\nnpm run typecheck\n\n# Run linting\nnpm run lint\n\n# Test database connection\nnode tools/quick-db-check.js\n```\n\n### Database Development\n\n```bash\n# Generate new migration after schema changes\nnpm run db:generate\n\n# Apply migrations\nnpm run db:migrate\n\n# Open database studio (GUI)\nnpm run db:studio\n\n# Reset database (development)\nnpm run db:reset\n\n# Check database status\nnode tools/quick-db-check.js\n```\n\n### Testing Utilities\n\n```bash\n# Test core functionality\nnode tools/test-create-chat.js     # Test chat creation\nnode tools/test-delete-message.js  # Test message deletion\nnode tools/test-ollama.js          # Test AI integration\n\n# Database diagnostics\nnode tools/diagnose-database.js    # Comprehensive database check\nnode tools/check-db-status.js      # Detailed database info\n```\n\n## 🧩 Component Development\n\n### UI Component Guidelines\n\n1. **Use ShadCN Components**: Build on top of the existing component system\n2. **Follow Naming Conventions**: PascalCase for components, kebab-case for files\n3. **TypeScript First**: Always define proper interfaces and types\n4. **Responsive Design**: Mobile-first approach with Tailwind breakpoints\n\n### Example Component Structure\n\n```typescript\n// src/components/feature/MyComponent.tsx\n\"use client\";\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { SomeIcon } from 'lucide-react';\n\ninterface MyComponentProps {\n  title: string;\n  onAction: () => void;\n  optional?: boolean;\n}\n\nexport default function MyComponent({ title, onAction, optional = false }: MyComponentProps) {\n  const [loading, setLoading] = useState(false);\n\n  const handleClick = async () => {\n    setLoading(true);\n    try {\n      await onAction();\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <SomeIcon className=\"h-5 w-5\" />\n          {title}\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <Button onClick={handleClick} disabled={loading}>\n          {loading ? 'Loading...' : 'Action'}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n```\n\n### Hook Development\n\n```typescript\n// src/hooks/use-my-feature.ts\nimport { useState, useEffect } from 'react';\nimport { useToast } from './use-toast';\n\ninterface UseMyFeatureResult {\n  data: any[];\n  loading: boolean;\n  error: string | null;\n  refetch: () => Promise<void>;\n}\n\nexport function useMyFeature(): UseMyFeatureResult {\n  const [data, setData] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const { toast } = useToast();\n\n  const fetchData = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      \n      const response = await fetch('/api/my-feature');\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n      \n      const result = await response.json();\n      setData(result.data || []);\n    } catch (err: any) {\n      const errorMessage = err.message || 'Unknown error';\n      setError(errorMessage);\n      toast({\n        title: 'Error',\n        description: errorMessage,\n        variant: 'destructive',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  return {\n    data,\n    loading,\n    error,\n    refetch: fetchData,\n  };\n}\n```\n\n## 🔌 API Development\n\n### API Route Guidelines\n\n1. **Always use Node.js runtime** for database/auth operations\n2. **Include proper error handling**\n3. **Follow RESTful conventions**\n4. **Use consistent response formats**\n\n### Example API Route\n\n```typescript\n// src/app/api/my-feature/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\nimport { localDb } from '@/lib/database-adapter';\nimport { getCurrentUser, isSingleUserMode } from '@/lib/auth/local-auth';\n\n// Force Node.js runtime for database operations\nexport const runtime = 'nodejs';\n\n// Default user for single-user mode\nconst SINGLE_USER_DEFAULT = {\n  id: 'default-user',\n  username: 'user',\n  email: 'user@localhost'\n};\n\nexport async function GET(request: NextRequest) {\n  try {\n    let user = await getCurrentUser(request);\n    \n    // In single-user mode, provide a default user if none exists\n    if (!user && isSingleUserMode()) {\n      user = SINGLE_USER_DEFAULT;\n    }\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 });\n    }\n\n    // Your logic here\n    const data = await localDb.myFeature.findAll(user.id);\n    \n    return NextResponse.json({ data });\n  } catch (error) {\n    console.error('Error in my-feature API:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    let user = await getCurrentUser(request);\n    \n    if (!user && isSingleUserMode()) {\n      user = SINGLE_USER_DEFAULT;\n    }\n    \n    if (!user) {\n      return NextResponse.json({ error: 'Authentication required' }, { status: 401 });\n    }\n\n    const body = await request.json();\n    \n    // Validate input\n    if (!body.name) {\n      return NextResponse.json({ error: 'Name is required' }, { status: 400 });\n    }\n\n    // Create record\n    const newRecord = await localDb.myFeature.create({\n      ...body,\n      userId: user.id,\n    });\n    \n    return NextResponse.json({ data: newRecord });\n  } catch (error) {\n    console.error('Error creating record:', error);\n    return NextResponse.json(\n      { error: 'Failed to create record' },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## 🗄️ Database Development\n\n### Schema Definition\n\n```typescript\n// src/lib/database/schema.ts (addition)\nexport const myFeatureTable = sqliteTable('my_feature', {\n  id: text('id').primaryKey(),\n  name: text('name').notNull(),\n  description: text('description'),\n  data: text('data', { mode: 'json' }).default('{}'),\n  createdAt: text('created_at').notNull().default(String(new Date().toISOString())),\n  updatedAt: text('updated_at').notNull().default(String(new Date().toISOString())),\n  userId: text('user_id').notNull().references(() => users.id)\n});\n```\n\n### Repository Pattern\n\n```typescript\n// src/lib/database/repositories.ts (addition)\nexport class MyFeatureRepository extends BaseRepository<typeof myFeatureTable, any, any> {\n  constructor() {\n    super(myFeatureTable);\n  }\n\n  async findByUserId(userId: string): Promise<any[]> {\n    const db = await getDb();\n    return db.select().from(myFeatureTable)\n      .where(eq(myFeatureTable.userId, userId))\n      .orderBy(desc(myFeatureTable.updatedAt));\n  }\n\n  async findByName(userId: string, name: string): Promise<any | null> {\n    const db = await getDb();\n    const results = await db.select().from(myFeatureTable)\n      .where(and(eq(myFeatureTable.userId, userId), eq(myFeatureTable.name, name)))\n      .limit(1);\n    return results[0] || null;\n  }\n}\n\nexport const myFeatureRepository = new MyFeatureRepository();\n```\n\n### Database Adapter Integration\n\n```typescript\n// src/lib/database-adapter.ts (addition)\nexport const myFeatureApi = {\n  async findAll(userId: string): Promise<any[]> {\n    return myFeatureRepository.findByUserId(userId);\n  },\n\n  async create(data: any): Promise<any> {\n    return myFeatureRepository.create({\n      ...data,\n      id: crypto.randomUUID(),\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n    });\n  },\n\n  // ... other operations\n};\n\n// Add to localDb export\nexport const localDb = {\n  // ... existing APIs\n  myFeature: myFeatureApi,\n};\n```\n\n## 🧪 Testing\n\n### Testing Strategy\n\n1. **Unit Tests**: Individual functions and components\n2. **Integration Tests**: API endpoints and database operations\n3. **Manual Testing**: Using utility scripts in `tools/`\n4. **User Testing**: End-to-end workflows\n\n### Creating Test Scripts\n\n```javascript\n// tools/test-my-feature.js\n#!/usr/bin/env node\n\nconst http = require('http');\n\nconst testData = {\n  name: 'Test Feature',\n  description: 'Testing my new feature'\n};\n\nconst options = {\n  hostname: 'localhost',\n  port: 9004,\n  path: '/api/my-feature',\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n  }\n};\n\nconsole.log('🧪 Testing my feature API...');\n\nconst req = http.request(options, (res) => {\n  console.log(`Status: ${res.statusCode}`);\n  \n  let body = '';\n  res.on('data', (chunk) => body += chunk);\n  res.on('end', () => {\n    try {\n      const response = JSON.parse(body);\n      console.log('Response:', JSON.stringify(response, null, 2));\n      \n      if (res.statusCode === 200) {\n        console.log('✅ SUCCESS: Feature API working!');\n      } else {\n        console.log('❌ FAILED: API returned error');\n      }\n    } catch (error) {\n      console.log('Parse error:', error.message);\n    }\n  });\n});\n\nreq.on('error', (error) => {\n  console.error('❌ Request failed:', error.message);\n});\n\nreq.write(JSON.stringify(testData));\nreq.end();\n```\n\n## 🚀 Deployment\n\n### Development Deployment\n\n```bash\n# Build the application\nnpm run build\n\n# Start production server\nnpm start\n```\n\n### Docker Deployment\n\n```bash\n# Build Docker image\ndocker build -t libreollama:latest .\n\n# Run with Docker Compose\ndocker-compose up -d\n\n# View logs\ndocker-compose logs -f\n```\n\n### Production Considerations\n\n1. **Environment Variables**: Secure JWT secrets\n2. **Database Backup**: Regular SQLite backups\n3. **SSL/TLS**: HTTPS in production\n4. **Resource Limits**: Memory and CPU limits for containers\n5. **Monitoring**: Log aggregation and health checks\n\n## 🎨 Styling Guidelines\n\n### Design System\n\n- **Primary Color**: Slate blue (#6A5ACD)\n- **Background**: Light gray (#F0F2F5)\n- **Accent**: Soft lavender (#E6E6FA)\n- **Typography**: Clean, modern fonts\n- **Icons**: Lucide React icon set\n\n### Tailwind CSS Usage\n\n```tsx\n// Good: Semantic and consistent\n<div className=\"bg-background text-foreground p-4 rounded-lg border\">\n  <h2 className=\"text-lg font-semibold text-primary mb-2\">\n    Title\n  </h2>\n  <p className=\"text-muted-foreground\">\n    Description\n  </p>\n</div>\n\n// Avoid: Hardcoded colors and magic numbers\n<div className=\"bg-gray-50 text-gray-900 p-4 rounded-lg border-gray-200\">\n  <h2 className=\"text-18px font-600 text-blue-600 mb-8px\">\n    Title\n  </h2>\n</div>\n```\n\n## 🔧 Debugging\n\n### Common Debugging Tools\n\n```bash\n# Database debugging\nnode tools/diagnose-database.js\nnode tools/quick-db-check.js\n\n# API testing\nnode tools/test-create-chat.js\nnode tools/test-delete-message.js\n\n# Ollama testing\nnode tools/test-ollama.js\n```\n\n### VS Code Debug Configuration\n\n```json\n// .vscode/launch.json\n{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Debug Next.js\",\n      \"type\": \"node\",\n      \"request\": \"attach\",\n      \"port\": 9229,\n      \"restart\": true,\n      \"skipFiles\": [\"<node_internals>/**\"]\n    }\n  ]\n}\n```\n\n### Browser Debugging\n\n1. **React DevTools**: Install browser extension\n2. **Network Tab**: Monitor API requests\n3. **Console**: Check for JavaScript errors\n4. **Application Tab**: Inspect localStorage and cookies\n\n## 📚 Resources\n\n### Documentation\n- [Next.js 15 Documentation](https://nextjs.org/docs)\n- [React 18 Documentation](https://react.dev/)\n- [Tailwind CSS](https://tailwindcss.com/docs)\n- [ShadCN UI](https://ui.shadcn.com/)\n- [Drizzle ORM](https://orm.drizzle.team/)\n- [Ollama Documentation](https://github.com/ollama/ollama)\n\n### Code Quality\n- **TypeScript**: Strict mode enabled\n- **ESLint**: Next.js recommended config\n- **Prettier**: Code formatting\n- **Husky**: Git hooks for pre-commit checks\n\n### Performance Tips\n\n1. **Database**: Use indexes for frequent queries\n2. **React**: Memoize expensive computations\n3. **Images**: Optimize and use Next.js Image component\n4. **Bundle**: Analyze bundle size with `@next/bundle-analyzer`\n5. **Caching**: Leverage Next.js caching strategies\n\nThis development guide provides a comprehensive foundation for working on LibreOllama. Follow these patterns and guidelines for consistent, maintainable code.\n